/**
 * Youxi Form Manager JS
 *
 * This script handles every form's initialization.
 *
 * @package   Youxi Core
 * @author    Mairel Theafila <maimairel@yahoo.com>
 * @copyright Copyright (c) 2013, Mairel Theafila
 */
;(function(a,m,k,n){a.Youxi=a.Youxi||{};a.extend(!0,a.Youxi,{Form:{Manager:{_callbacks:{init:{},destroy:{}},addCallbacks:function(c,b,g){a.isFunction(b)&&(this._callbacks.init[c]=b);a.isFunction(g)&&(this._callbacks.destroy[c]=g)},removeCallbacks:function(a){delete this._callbacks.init[a];delete this._callbacks.destroy[a]},initialize:function(c,b){"undefined"!==typeof b?this._callbacks.init.hasOwnProperty(b)&&this._callbacks.init.name.apply(this,[c]):a.each(this._callbacks.init,function(a,b){b.apply(this,[c])})},destroy:function(c,b){"undefined"!==typeof b?this._callbacks.destroy.hasOwnProperty(b)&&this._callbacks.destroy.name.apply(this,[c]):a.each(this._callbacks.destroy,function(a,b){b.apply(this,[c])})}},parseCriteria:_.memoize(function(a){for(var b,g=/(.+?):(is|isnot|not|contains|less_than|less_than_or_equal_to|greater_than|greater_than_or_equal_to)\((.*?)\),?/g,h=[];b=g.exec(a);)h.push({check:b[1],rule:b[2],value:b[3]});return h}),criteriaCheck:function(c){a("[data-field-scope][data-criteria]",c).each(function(){if(!a(this).closest(".youxi-repeater-template").length){var b,g=a(this).data("field-scope"),h=a.Youxi.Form.parseCriteria(a(this).data("criteria")),k=(a(this).data("criteria-operator")||"and").toLowerCase();a.each(h,function(h,l){var d=a("#"+g+"_"+l.check+"_group",c).find('select, input[type="radio"]:checked, input[type="checkbox"]').first();d.is(":checkbox")&&!d.is(":checked")&&(d=d.siblings('input[type="hidden"][name="'+d.attr("name")+'"]').first());if(d.length){var d=d.val().toString(),f=l.value.toString(),e;switch(l.rule){case "is":e=d==f;break;case "isnot":case "not":e=d!=f;break;case "less_than":e=parseInt(d)<parseInt(f);break;case "less_than_or_equal_to":e=parseInt(d)<=parseInt(f);break;case "greater_than":e=parseInt(d)>parseInt(f);break;case "greater_than_or_equal_to":e=parseInt(d)>=parseInt(f);break;case "contains":e=-1!==f.indexOf(d)?!0:!1}_.isUndefined(b)&&(b=e);switch(k){case "or":b=b||e;break;default:b=b&&e}}});a(this).toggle(b).find(":input").attr("disabled",!b)}})}}});a(k).on("change.conditional-toggle","[data-field-scope]",function(c){a(c.target).is('select, input[type="radio"]:checked, input[type="checkbox"]')&&a.contains(this,c.target)&&a.Youxi.Form.criteriaCheck(a(this).closest("[data-field-scope]").parent())});a.Youxi.Form.Manager.addCallbacks("conditional-toggle",function(c){a.Youxi.Form.criteriaCheck(c)});a.Youxi.Form.Tabs=function(c){this.element=a(c);return this.init()};a.Youxi.Form.Tabs.prototype={init:function(){this.element.on("click.youxi-form-tabs",'.youxi-form-tabs-nav a[href^="#"]',this.change);this.change.apply(this.element.find('.youxi-form-tabs-nav li:first-child a[href^="#"]'))},change:function(c){a(this).closest(".youxi-form-tabs-nav ul li").addClass("active").siblings().removeClass("active");a(this).closest(".youxi-form-tabs").find(".youxi-form-tabs-content "+a(this).attr("href")).show().siblings().hide();c&&c.preventDefault()}};a.Youxi.Form.Manager.addCallbacks("form-tabs",function(c){a(".youxi-form-tabs",c).each(function(){new a.Youxi.Form.Tabs(this)})},function(c){a(".youxi-form-tabs",c).off(".youxi-form-tabs")});a(k).ready(function(){a.Youxi.Form.Manager.initialize(this)})})(jQuery,window,document);